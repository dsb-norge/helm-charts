{{- $port := .Values.port }}
{{- $resourceName := .Values.resourceName }}
{{- if or .Values.ingress_host .Values.ingress -}}
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: {{ .Values.resourceName }}
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/name: {{ .Values.dashboard.name | default .Release.Name }}
    app.kubernetes.io/component: {{ .Values.dashboard.component | default "Function" }}
    app.kubernetes.io/part-of: {{ .Values.dashboard.partOf | default .Release.Name }}
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    app.kubernetes.io/created-by: {{ .Values.dashboard.createdBy | default .Release.Service }}
    helm.sh/chart-name: {{ .Chart.Name }}
    helm.sh/chart-version: {{ .Chart.Version | replace "+" "_" }}
    helm.sh/chart: {{ .Chart.Name }}-{{ .Chart.Version | replace "+" "_" }}
spec:
  rules:
  {{- if .Values.ingress_host }}
  - host: "{{ .Values.ingress_host }}"
    http:
      paths:
        - path: "{{ .Values.ingress_path }}"
          pathType: Prefix
          backend:
            service:
              name: "{{ .Values.resourceName }}"
              port:
                number: {{ .Values.port }}
  {{- end }}
  {{- range $ing := .Values.ingress }}
  - host: {{ $ing.host }}
    http:
      paths:
        - path: {{ $ing.path | default "/" }}
          pathType: Prefix
          backend:
            service:
              name: "{{ $resourceName }}"
              port:
                number: {{ $port }}
  {{- end }}
{{- end -}}
